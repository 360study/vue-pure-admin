{"version":3,"file":"hook-79f1f89e.js","sources":["../../../src/views/system/user/hook.tsx"],"sourcesContent":["import dayjs from \"dayjs\";\nimport { message } from \"@/utils/message\";\nimport { getUserList } from \"@/api/system\";\nimport { ElMessageBox } from \"element-plus\";\nimport { type PaginationProps } from \"@pureadmin/table\";\nimport { reactive, ref, computed, onMounted } from \"vue\";\n\nexport function useUser() {\n  const form = reactive({\n    username: \"\",\n    mobile: \"\",\n    status: \"\"\n  });\n  const dataList = ref([]);\n  const loading = ref(true);\n  const switchLoadMap = ref({});\n  const pagination = reactive<PaginationProps>({\n    total: 0,\n    pageSize: 10,\n    currentPage: 1,\n    background: true\n  });\n  const columns: TableColumnList = [\n    {\n      label: \"序号\",\n      type: \"index\",\n      width: 70,\n      fixed: \"left\"\n    },\n    {\n      label: \"用户编号\",\n      prop: \"id\",\n      minWidth: 130\n    },\n    {\n      label: \"用户名称\",\n      prop: \"username\",\n      minWidth: 130\n    },\n    {\n      label: \"用户昵称\",\n      prop: \"nickname\",\n      minWidth: 130\n    },\n    {\n      label: \"性别\",\n      prop: \"sex\",\n      minWidth: 90,\n      cellRenderer: ({ row, props }) => (\n        <el-tag\n          size={props.size}\n          type={row.sex === 1 ? \"danger\" : \"\"}\n          effect=\"plain\"\n        >\n          {row.sex === 1 ? \"女\" : \"男\"}\n        </el-tag>\n      )\n    },\n    {\n      label: \"部门\",\n      prop: \"dept\",\n      minWidth: 90,\n      formatter: ({ dept }) => dept.name\n    },\n    {\n      label: \"手机号码\",\n      prop: \"mobile\",\n      minWidth: 90\n    },\n    {\n      label: \"状态\",\n      prop: \"status\",\n      minWidth: 90,\n      cellRenderer: scope => (\n        <el-switch\n          size={scope.props.size === \"small\" ? \"small\" : \"default\"}\n          loading={switchLoadMap.value[scope.index]?.loading}\n          v-model={scope.row.status}\n          active-value={1}\n          inactive-value={0}\n          active-text=\"已开启\"\n          inactive-text=\"已关闭\"\n          inline-prompt\n          onChange={() => onChange(scope as any)}\n        />\n      )\n    },\n    {\n      label: \"创建时间\",\n      minWidth: 90,\n      prop: \"createTime\",\n      formatter: ({ createTime }) =>\n        dayjs(createTime).format(\"YYYY-MM-DD HH:mm:ss\")\n    },\n    {\n      label: \"操作\",\n      fixed: \"right\",\n      width: 180,\n      slot: \"operation\"\n    }\n  ];\n  const buttonClass = computed(() => {\n    return [\n      \"!h-[20px]\",\n      \"reset-margin\",\n      \"!text-gray-500\",\n      \"dark:!text-white\",\n      \"dark:hover:!text-primary\"\n    ];\n  });\n\n  function onChange({ row, index }) {\n    ElMessageBox.confirm(\n      `确认要<strong>${\n        row.status === 0 ? \"停用\" : \"启用\"\n      }</strong><strong style='color:var(--el-color-primary)'>${\n        row.username\n      }</strong>用户吗?`,\n      \"系统提示\",\n      {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n        dangerouslyUseHTMLString: true,\n        draggable: true\n      }\n    )\n      .then(() => {\n        switchLoadMap.value[index] = Object.assign(\n          {},\n          switchLoadMap.value[index],\n          {\n            loading: true\n          }\n        );\n        setTimeout(() => {\n          switchLoadMap.value[index] = Object.assign(\n            {},\n            switchLoadMap.value[index],\n            {\n              loading: false\n            }\n          );\n          message(\"已成功修改用户状态\", {\n            type: \"success\"\n          });\n        }, 300);\n      })\n      .catch(() => {\n        row.status === 0 ? (row.status = 1) : (row.status = 0);\n      });\n  }\n\n  function handleUpdate(row) {\n    console.log(row);\n  }\n\n  function handleDelete(row) {\n    console.log(row);\n  }\n\n  function handleSizeChange(val: number) {\n    console.log(`${val} items per page`);\n  }\n\n  function handleCurrentChange(val: number) {\n    console.log(`current page: ${val}`);\n  }\n\n  function handleSelectionChange(val) {\n    console.log(\"handleSelectionChange\", val);\n  }\n\n  async function onSearch() {\n    loading.value = true;\n    const { data } = await getUserList();\n    dataList.value = data.list;\n    pagination.total = data.total;\n    setTimeout(() => {\n      loading.value = false;\n    }, 500);\n  }\n\n  const resetForm = formEl => {\n    if (!formEl) return;\n    formEl.resetFields();\n    onSearch();\n  };\n\n  onMounted(() => {\n    onSearch();\n  });\n\n  return {\n    form,\n    loading,\n    columns,\n    dataList,\n    pagination,\n    buttonClass,\n    onSearch,\n    resetForm,\n    handleUpdate,\n    handleDelete,\n    handleSizeChange,\n    handleCurrentChange,\n    handleSelectionChange\n  };\n}\n"],"names":["useUser","form","reactive","username","mobile","status","dataList","ref","loading","switchLoadMap","pagination","total","pageSize","currentPage","background","columns","label","type","width","fixed","prop","minWidth","cellRenderer","row","props","_createVNode","_resolveComponent","size","sex","default","formatter","dept","name","scope","value","index","$event","onChange","createTime","dayjs","format","slot","buttonClass","computed","ElMessageBox","confirm","confirmButtonText","cancelButtonText","dangerouslyUseHTMLString","draggable","then","Object","assign","setTimeout","message","catch","handleUpdate","console","handleDelete","handleSizeChange","val","handleSelectionChange","onSearch","data","handleCurrentChange","resetForm","formEl","onMounted"],"mappings":"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"}